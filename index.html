<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Samsung Portal (Secure)</title>
    <!-- Crypto Library for Decryption -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #034EA2; --bg: #F4F7F6; --white: #ffffff; }
        body { font-family: 'Roboto', sans-serif; background: var(--bg); margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        /* === LOCK SCREEN === */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #034EA2; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; transition: opacity 0.5s;
        }
        .lock-icon { font-size: 60px; margin-bottom: 20px; }
        .login-title { font-size: 24px; font-weight: bold; margin-bottom: 30px; letter-spacing: 1px; }
        
        .pin-box {
            background: white; color: #333; font-size: 24px; letter-spacing: 5px;
            text-align: center; border: none; padding: 15px; border-radius: 12px;
            width: 200px; font-family: monospace; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            outline: none;
        }
        .login-btn {
            margin-top: 20px; padding: 12px 40px; background: rgba(255,255,255,0.2);
            border: 2px solid white; color: white; border-radius: 30px;
            font-weight: bold; cursor: pointer; font-size: 16px;
        }
        .login-btn:active { background: white; color: #034EA2; }
        .error-msg { color: #ff8a80; margin-top: 15px; font-weight: bold; display: none; }

        /* === MAIN APP === */
        #app-container { display: none; padding: 15px; padding-bottom: 80px; }
        
        .header { text-align: center; margin-bottom: 20px; margin-top: 10px; }
        .header h1 { color: var(--primary); font-size: 22px; margin: 0; }
        
        .card { background: var(--white); padding: 20px; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .form-group { margin-bottom: 12px; }
        label { font-size: 11px; font-weight: bold; color: #555; display: block; margin-bottom: 5px; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background: #fafafa; box-sizing: border-box; }
        
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }

        .gen-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; margin-top: 15px; cursor: pointer; }
        .gen-btn:disabled { background: #ccc; }

        #outputArea { margin-top: 20px; }
        .msg-card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 5px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .msg-text { white-space: pre-wrap; font-size: 15px; line-height: 1.5; color: #333; }
        .wa-btn { background: #25D366; color: white; border: none; padding: 10px; border-radius: 6px; width: 100%; margin-top: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        .logout-link { display: block; text-align: center; margin-top: 30px; color: #d00; text-decoration: underline; cursor: pointer; font-size: 12px; }
        .log { font-size: 10px; color: #aaa; text-align: center; margin-top: 5px; }
    </style>
</head>
<body>

<!-- üîí SECURE LOGIN SCREEN -->
<div id="login-overlay">
    <div class="lock-icon">üîê</div>
    <div class="login-title">SECURE LOGIN</div>
    <input type="password" id="pinInput" class="pin-box" placeholder="PIN" maxlength="6">
    <button class="login-btn" onclick="unlockApp()">UNLOCK</button>
    <div id="loginError" class="error-msg">INCORRECT PIN</div>
</div>

<!-- üì± MAIN APP INTERFACE -->
<div id="app-container">
    <div class="header">
        <h1>AI Manager ‚ö°</h1>
        <p>Authenticated Session</p>
    </div>

    <div class="card">
        <div class="form-group"><label>Shop Name (Auto-Saved)</label><input type="text" id="shop" onchange="saveShop()"></div>
        <div class="form-group"><label>Customer Name</label><input type="text" id="name" placeholder="e.g. Abinash"></div>
        <div class="form-group"><label>Mobile (For Link)</label><input type="number" id="mobile" placeholder="98XXXXXXXX"></div>
        
        <div class="row">
            <div class="col"><label>Amount (‚Çπ)</label><input type="number" id="amount" placeholder="50000"></div>
            <div class="col">
                <label>Down Payment</label>
                <select id="dp">
                    <option value="0%">0%</option>
                    <option value="5%">5%</option>
                    <option value="10%">10%</option>
                    <option value="15%">15%</option>
                    <option value="20%">20%</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col"><label>Old Phone</label><input type="text" id="phone" placeholder="Galaxy M51"></div>
            <div class="col"><label>Expiry</label><input type="date" id="expiry"></div>
        </div>

        <div class="form-group">
            <label>Language</label>
            <select id="lang">
                <option value="English">English</option>
                <option value="Odia">Odia</option>
                <option value="Bengali">Bengali</option>
                <option value="Hindi">Hindi</option>
            </select>
        </div>
        
        <button class="gen-btn" onclick="generate()">Generate Messages üöÄ</button>
        <div id="statusLog" class="log"></div>
    </div>

    <div id="outputArea"></div>
    <span class="logout-link" onclick="location.reload()">üîí Lock App</span>
</div>

<script>
    // ======================================================
    // üëáüëá PASTE THE GENERATED STRING HERE üëáüëá
    const SECRET_DATA = "U2FsdGVkX18X1XeeCiOcwrZ0d30o4KTwc87k8nH42kCG73I4lkWGXQRvyAU736AiJwDCMRwqT2pHmNPdgjJk4A=="; 
    // ======================================================

    let DECRYPTED_KEY = ""; // Key lives here only while app is open

    // 1. LOGIN LOGIC
    function unlockApp() {
        const pin = document.getElementById("pinInput").value;
        const errorMsg = document.getElementById("loginError");

        if (!pin) return;

        try {
            // Attempt to decrypt using the PIN entered
            const bytes = CryptoJS.AES.decrypt(SECRET_DATA, pin);
            const originalText = bytes.toString(CryptoJS.enc.Utf8);

            // Validation: Google Keys always start with "AIza"
            if (originalText.startsWith("AIza")) {
                DECRYPTED_KEY = originalText; // Success! Key is now in memory
                
                // Hide Login, Show App
                document.getElementById("login-overlay").style.display = "none";
                document.getElementById("app-container").style.display = "block";
                
                // Load saved shop name
                if(localStorage.getItem("shopName")) document.getElementById("shop").value = localStorage.getItem("shopName");
                
                // Set Date default
                const d = new Date(); d.setDate(d.getDate() + 7);
                document.getElementById("expiry").valueAsDate = d;
            } else {
                throw new Error("Bad Decrypt");
            }
        } catch (e) {
            errorMsg.style.display = "block";
            document.getElementById("pinInput").value = "";
        }
    }

    function saveShop() { localStorage.setItem("shopName", document.getElementById("shop").value); }

    // 2. AI GENERATION LOGIC
    async function generate() {
        const name = document.getElementById("name").value.trim();
        const mobile = document.getElementById("mobile").value.trim();
        const amount = document.getElementById("amount").value;
        const dp = document.getElementById("dp").value;
        const phone = document.getElementById("phone").value;
        const expiry = document.getElementById("expiry").value;
        const lang = document.getElementById("lang").value;
        const shop = document.getElementById("shop").value;
        const log = document.getElementById("statusLog");

        if(!name) { alert("Enter Name"); return; }
        const btn = document.querySelector(".gen-btn");
        btn.disabled = true;
        document.getElementById("outputArea").innerHTML = "";

        // Use the Decrypted Key
        log.innerText = "üîç Connecting to AI...";
        let modelName = await findModel(DECRYPTED_KEY);
        
        if (!modelName) {
            log.innerText = "‚ùå API Error. Key might be restricted.";
            btn.disabled = false;
            return;
        }

        log.innerText = `‚úÖ Generating...`;
        let dateText = "Limited Time";
        if(expiry) dateText = new Date(expiry).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });

        const prompt = `Act as Samsung Manager. Write 3 unique WhatsApp messages for "${name}" in ${lang}. 
        Details: Loan ‚Çπ${amount}, Old Phone: ${phone}, Down Payment: ${dp}, Expiry: ${dateText}, Shop: ${shop}. 
        Rules: Mention 'No Paperwork'. Suggest upgrading to Samsung 5G. Use emojis.
        Output: 3 messages separated by |||.`;

        const url = `https://generativelanguage.googleapis.com/v1beta/${modelName}:generateContent?key=${DECRYPTED_KEY}`;

        try {
            const response = await fetch(url, {
                method: "POST", headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await response.json();
            const texts = data.candidates[0].content.parts[0].text.split("|||");
            texts.forEach(t => { if(t.trim().length > 5) createCard(t.trim(), mobile); });
            log.innerText = "Done! ‚ú®";
        } catch (err) { alert("Network Error"); }
        btn.disabled = false;
    }

    async function findModel(key) {
        try {
            const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
            const d = await r.json();
            if(d.models) {
                // Priority: Flash -> Pro -> Any Gemini
                const flash = d.models.find(m => m.name.includes("flash") && m.supportedGenerationMethods.includes("generateContent"));
                if(flash) return flash.name;
                const any = d.models.find(m => m.name.includes("gemini") && m.supportedGenerationMethods.includes("generateContent"));
                if(any) return any.name;
            }
            return "models/gemini-1.5-flash";
        } catch(e) { return "models/gemini-1.5-flash"; }
    }

    function createCard(text, mobile) {
        const div = document.createElement("div");
        div.className = "msg-card";
        let waLink = `https://wa.me/?text=${encodeURIComponent(text)}`;
        if(mobile.length >= 10) waLink = `https://wa.me/91${mobile.replace(/\D/g,'')}?text=${encodeURIComponent(text)}`;
        div.innerHTML = `<div class="msg-text">${text}</div><button class="wa-btn" onclick="window.open('${waLink}', '_blank')"><span>üü¢</span> Send WhatsApp</button>`;
        document.getElementById("outputArea").appendChild(div);
    }
</script>
</body>
</html>
