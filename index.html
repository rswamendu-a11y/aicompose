<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samsung AI DIAGNOSTIC V10</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        input { width: 100%; padding: 15px; border-radius: 5px; border: none; font-family: monospace; }
        button { width: 100%; padding: 20px; background: #d00; color: white; font-weight: bold; border: none; margin-top: 20px; font-size: 18px; border-radius: 5px; cursor: pointer; }
        #console { margin-top: 20px; border: 1px solid #333; padding: 10px; background: #111; min-height: 200px; white-space: pre-wrap; word-break: break-all; }
        .success { color: #0f0; }
        .error { color: #f00; font-weight: bold; }
        .warning { color: yellow; }
    </style>
</head>
<body>

    <h1>⚠️ DIAGNOSTIC MODE V10</h1>
    <p>Paste API Key below to find the real error:</p>
    
    <input type="text" id="apiKey" placeholder="Paste AIzaSy...">
    <button onclick="runTest()">RUN SYSTEM TEST</button>

    <h3>SYSTEM LOG:</h3>
    <div id="console">Ready to test...</div>

    <script>
        // Auto-load key if saved
        if(localStorage.getItem("v10_key")) document.getElementById("apiKey").value = localStorage.getItem("v10_key");

        function log(msg, type = "") {
            const box = document.getElementById("console");
            const time = new Date().toLocaleTimeString();
            box.innerHTML += `<div class="${type}">[${time}] ${msg}</div>`;
        }

        async function runTest() {
            const key = document.getElementById("apiKey").value.trim();
            const consoleBox = document.getElementById("console");
            
            if(key.length < 30) {
                alert("That API Key looks too short.");
                return;
            }

            // Save key
            localStorage.setItem("v10_key", key);
            consoleBox.innerHTML = ""; // Clear log
            log("Starting Network Test...", "warning");
            log("Key Length: " + key.length + " characters.");
            log("Checking for hidden spaces...", "warning");

            if (key.includes(" ")) {
                log("FAIL: Key contains spaces! Delete them.", "error");
                return;
            }

            // TEST 1: GEMINI FLASH (Modern)
            log("--------------------------------");
            log("TEST 1: Connecting to Gemini 1.5 Flash...");
            const url1 = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
            await makeCall(url1);

            // TEST 2: GEMINI PRO (Legacy)
            log("--------------------------------");
            log("TEST 2: Connecting to Gemini Pro...");
            const url2 = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`;
            await makeCall(url2);
        }

        async function makeCall(url) {
            const prompt = { contents: [{ parts: [{ text: "Say Hello" }] }] };

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(prompt)
                });

                log("HTTP Status: " + response.status, response.ok ? "success" : "error");

                const data = await response.json();

                if (response.ok) {
                    log("SUCCESS! Connection Established.", "success");
                    log("AI Response: " + data.candidates[0].content.parts[0].text);
                } else {
                    log("GOOGLE ERROR MESSAGE:", "error");
                    log(JSON.stringify(data.error, null, 2), "error");
                    
                    // Diagnosis help
                    if(response.status === 400) log("HINT: API Key is Invalid or Permissions missing.", "warning");
                    if(response.status === 403) log("HINT: Region Blocked OR Key Restrictions Active.", "warning");
                    if(response.status === 404) log("HINT: Model name changed.", "warning");
                }

            } catch (err) {
                log("NETWORK ERROR (Browser Blocked):", "error");
                log(err.message, "error");
                log("HINT: This usually means you are offline OR a firewall is blocking this.", "warning");
            }
        }
    </script>

</body>
</html>
